@page "/Transactionshistory"
@using BudgetPlusPlus.Data
@using BudgetPlusPlus.Domain
@inject BudgetPlusPlusContext Db
@inject NavigationManager Nav
@inject AuthenticationStateProvider AuthState

<h3>Transactions History</h3>

<table>
    <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Category</th>
        <th>Amount</th>
    </tr>

    @foreach (var t in Transactionss)
    {
        <tr>
            <td>@t.Date.ToShortDateString()</td>
            <td>@t.Type</td>
            <td>@t.Category</td>
            <td>@t.Amount</td>
        </tr>
    }
</table>

@code {
    List<Transactions> Transactionss = new();

    protected override async Task OnInitializedAsync()
    {
        var auth = await AuthState.GetAuthenticationStateAsync();
        var userId = auth.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;

        Transactionss = Db.Transactions
            .Where(t => t.UserId == userId)
            .OrderByDescending(t => t.Date)
            .ToList();
    }
}